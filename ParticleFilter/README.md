# Particle Filter and User Simulation

This part of the project is a particle filter and user simulation.


Particle Filter
-----
For the particle filter mode, we load a map of a building floor, and run the particle filter algorithm over a data feed file. This data feed contains the probabilities of each region on the map based on the classifier's output at that time step. Regions include hallways, staircases, elevators, standing areas, sitting areas, and doors. This data feed can also contain odometry and turning information which will be used to update the particles. Although this input data can be noisy, the particle filter is fairly resilient against noise.

The particle filter draws estimated locations on the screen of the GUI. Clusters of particles are considered as a single hypothesis, and the cluster with the highest overall particle weight is used as the best guess. If the feed data includes ground truth information, this will also be drawn on the screen as a green circle, and the estimated error will be displayed (in pixels).


Simulation
------
If real-world data is not available from the classifier, we can simulate a user's movement through the building. By running the program in simulation mode, we can move the user with a mouse over the map. We can then save the feed file generated by this movement. If we run the particle filter on this artificial feed file, we can add artificial noise by specifying runtime parameters, to make the simulation more realistic.


Video
------
https://youtu.be/gFB34H4qNEM

In this video, we first run the simulation to generate an artificial user, and then run the particle filter on the simulated feed data.


Usage Instructions
------
The bash `run` script allows the particle filter to be run in either mode easily. If bash is not available, the python command specified in the bash script can be run directly. This program is written in Python 2.

`./run sim` will execute it in simulation mode.

`./run pf` will execute it in particle filter mode.

*Simulation Mode*
******
`./run sim` to start simulation mode. In the bash `run` script, set up the `feed_file` parameter to whatever file you want your logs to be exported to. You can also adjust the configuration file and the map data, but we only provide one of each.

Once the window loads, press `esc` to lock or unlock the simulation. While the simulation is locked, you will not be able to move the artificial user. When the simulation is unlocked, right click to teleport to any location on the map. Left click to make the user start moving towards the mouse. While the left mouse button is being held down, the simulator will log the user's movements. The user will not move if the mouse is inisde the red circle around the user (but logging will still continue). Only the regions that are colored are valid. All white, gray, and black regions are walls or empty space. The particle filter will be confused if you move the user there.

When you are ready to export the data, press `esc` to lock the simulation, and click the `Save Logs` button. If you don't see any errors on the command line, it saved correctly. Exit and restart the program to clear all logs.

*Particle Filter Mode*
******
`./run pf` to start the particle filter mode. In the bash `run` script, set up the `cnoise` and `mnoise` parameters to whatever noise values you want for the classifier noise and motion noise, respectively. We find that 0.2 for both works fairy well while providing some amount of noise. The `feed_file` parameter should be the same file you exported in simulation mode. When the particle filter starts running, just sit back and watch as the particle fitler does its thing. The program will quit and report an average error once it's finished running.

*Particle Filter Configuration*
******
Our default configuration file is `Data/pf_config.txt`. You can adjust the parameters as you see fit. The default values are what we found to be successful.
